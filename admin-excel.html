<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Email Assistant – Assistant Excel</title>
    <meta name="robots" content="noindex, nofollow" />
    <link rel="icon" href="/favicon.ico" />
    <style>
      :root {
        --bg: #f8fafc; --panel: #ffffff; --muted: #64748b; --border: #e2e8f0; --teal:#059669; --warn:#eab308; --danger:#e54848;
      }
      *{box-sizing:border-box} html,body{height:100%}
      body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:linear-gradient(180deg,#f7fee7,var(--bg));color:#0f172a}
      header{position:sticky;top:0;z-index:10;display:flex;align-items:center;gap:10px;padding:12px 16px;background:rgba(255,255,255,0.8);backdrop-filter:blur(8px);border-bottom:1px solid var(--border)}
      header .brand{font-weight:800;display:flex;align-items:center;gap:10px}
      header .dot{width:10px;height:10px;border-radius:50%;background:var(--teal);box-shadow:0 0 0 3px rgba(16,185,129,.2)}
      header .spacer{flex:1}
      header button{border:1px solid var(--border);background:#fff;color:#0f172a;padding:8px 12px;border-radius:10px;font-weight:700;cursor:pointer}
      header button.primary{background:var(--teal);border-color:var(--teal);color:#fff}
      .container{display:grid;grid-template-columns:1fr 360px;gap:16px;padding:16px}
      .panel{background:var(--panel);border:1px solid var(--border);border-radius:16px;box-shadow:0 6px 30px rgba(2,6,23,.06)}
      .panel .head{padding:14px 16px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
      .panel .body{padding:16px}
      .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
      .field label{display:block;font-size:12px;color:var(--muted);font-weight:700;margin-bottom:6px}
      .field input,.field textarea,.field select{width:100%;border:1px solid var(--border);padding:10px 12px;border-radius:12px;font:inherit}
      .hint{font-size:12px;color:var(--muted)}
      .chips{display:flex;flex-wrap:wrap;gap:6px}
      .chip{background:#fef3c7;border:1px solid #fde68a;color:#92400e;padding:3px 8px;border-radius:999px;font-weight:700;font-size:12px}
      .warn{background:#fff7ed;border:1px solid #fed7aa;color:#9a3412;padding:10px 12px;border-radius:10px}
      .ok{background:#f0fdf4;border:1px solid #bbf7d0;color:#14532d;padding:10px 12px;border-radius:10px}
      @media (max-width: 1100px){ .container{grid-template-columns:1fr} .row{grid-template-columns:1fr} }
    </style>
  </head>
  <body>
    <header>
      <div class="brand"><span class="dot"></span> Assistant Excel</div>
      <div class="spacer"></div>
      <a href="./admin.html"><button>↩ Retour à la console</button></a>
    </header>
    <div id="notice" style="display:none; position: fixed; top: 12px; right: 12px; z-index: 1000; background: #111827; color: #fff; padding: 10px 12px; border-radius: 10px; border:1px solid rgba(255,255,255,0.1); font-weight: 600; font-size: 14px;"></div>
    <div class="container">
      <main class="panel">
        <div class="head"><strong>Fichier Excel et options</strong></div>
        <div class="body">
          <div class="row">
            <div class="field"><label>Fichier Excel (.xlsx)</label><input id="inp-xlsx" type="file" accept=".xlsx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" /></div>
            <div class="field"><label>Nom du client (pour le nom de fichier)</label><input id="inp-client" placeholder="ex: translationbureau" /></div>
          </div>
          <div class="row">
            <div class="field">
              <label>Générer des templates manquants</label>
              <select id="inp-generate">
                <option value="no" selected>Non</option>
                <option value="yes">Oui</option>
              </select>
            </div>
            <div class="field">
              <label>Catégorie par défaut (si vide)</label>
              <input id="inp-default-cat" placeholder="ex: Divers" />
            </div>
          </div>
          <div class="hint">Colonnes acceptées (insensibles à la casse): ID, CATEGORY_FR|CATEGORY_EN, TITLE_FR|TITLE_EN, DESCRIPTION_FR|DESCRIPTION_EN, SUBJECT_FR|SUBJECT_EN, BODY_FR|BODY_EN, VARS_FR|VARS_EN, VARS_DESC_FR|VARS_DESC_EN.</div>
          <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
            <button id="btn-parse" class="primary">Analyser le fichier</button>
            <button id="btn-export" disabled>Exporter JSON</button>
            <button id="btn-import-admin" disabled>Importer dans la console</button>
            <button id="btn-replace-repo" disabled title="Mode dev uniquement – Écrit complete_email_templates.json et recharge">Replace repo file now</button>
            <button id="btn-dl-template" title="Télécharger un modèle Excel prêt à remplir">Télécharger modèle Excel</button>
          </div>
        </div>
      </main>
      <aside class="panel">
        <div class="head"><strong>Validation</strong></div>
        <div class="body">
          <div id="summary" class="ok" style="display:none"></div>
          <div id="warnings" class="warn" style="display:none; margin-top:12px"></div>
          <div id="errors" class="warn" style="display:none; margin-top:12px; border-color:#fecaca; color:#991b1b; background:#fef2f2"></div>
          <div style="margin-top:12px;border-top:1px solid var(--border);padding-top:12px"></div>
          <div>
            <div class="head" style="padding:0 0 8px 0; border:none"><strong>Entrées analysées</strong></div>
            <div id="rows" style="display:grid; gap:8px; max-height:32vh; overflow:auto"></div>
            <div id="preview" style="margin-top:12px; display:none">
              <div class="head" style="padding:0 0 8px 0; border:none"><strong>Aperçu de l’entrée</strong></div>
              <div id="pv-body"></div>
            </div>
          </div>
          <div style="margin-top:12px;border-top:1px solid var(--border);padding-top:12px"></div>
          <div>
            <div class="head" style="padding:0 0 8px 0; border:none"><strong>Suggestions (facultatif)</strong></div>
            <div id="suggestions" style="display:grid; gap:8px;"></div>
          </div>
        </div>
      </aside>
    </div>

    <script type="module" src="./assets/admin-excel.js"></script>
  </body>
  </html>
